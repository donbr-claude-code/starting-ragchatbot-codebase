# RAG System Query Flow Diagram

## Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                FRONTEND                                         │
│                            (frontend/script.js)                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌─────────────────┐  │
│  │ User Input  │───▶│ Validation   │───▶│ UI Update   │───▶│ HTTP POST       │  │
│  │ & Click     │    │ & Disable    │    │ (Loading)   │    │ /api/query      │  │
│  └─────────────┘    └──────────────┘    └─────────────┘    └─────────────────┘  │
└─────────────────────────────────────────────────────┬───────────────────────────┘
                                                      │
                                    ┌─────────────────▼─────────────────┐
                                    │        NETWORK LAYER              │
                                    │     (HTTP JSON Request)           │
                                    └─────────────────┬─────────────────┘
                                                      │
┌─────────────────────────────────────────────────────▼───────────────────────────┐
│                              BACKEND API                                       │
│                             (backend/app.py)                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌─────────────────┐  │
│  │ FastAPI     │───▶│ Session      │───▶│ RAG System  │───▶│ Response        │  │
│  │ Endpoint    │    │ Management   │    │ Query()     │    │ Formatting      │  │
│  └─────────────┘    └──────────────┘    └─────────────┘    └─────────────────┘  │
└─────────────────────────────────────────────────────┬───────────────────────────┘
                                                      │
┌─────────────────────────────────────────────────────▼───────────────────────────┐
│                            RAG ORCHESTRATOR                                    │
│                           (backend/rag_system.py)                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌─────────────────┐  │
│  │ Prompt      │───▶│ History      │───▶│ AI Generator│───▶│ Source          │  │
│  │ Creation    │    │ Retrieval    │    │ Call        │    │ Collection      │  │
│  └─────────────┘    └──────────────┘    └─────────────┘    └─────────────────┘  │
└─────────────────────────────────────────────────────┬───────────────────────────┘
                                                      │
┌─────────────────────────────────────────────────────▼───────────────────────────┐
│                            AI GENERATOR                                        │
│                          (backend/ai_generator.py)                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌─────────────────┐  │
│  │ Claude API  │───▶│ Tool         │───▶│ Tool        │───▶│ Final Response  │  │
│  │ Call        │    │ Decision     │    │ Execution   │    │ Generation      │  │
│  └─────────────┘    └──────────────┘    └─────────────┘    └─────────────────┘  │
└─────────────────────────────────────────────────────┬───────────────────────────┘
                                                      │
                                    ┌─────────────────▼─────────────────┐
                                    │         TOOL MANAGER              │
                                    │      (backend/search_tools.py)     │
                                    └─────────────────┬─────────────────┘
                                                      │
┌─────────────────────────────────────────────────────▼───────────────────────────┐
│                           SEARCH EXECUTION                                     │
│                         (backend/search_tools.py)                              │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌─────────────────┐  │
│  │ Parameter   │───▶│ Vector Store │───▶│ Result      │───▶│ Source          │  │
│  │ Processing  │    │ Search       │    │ Formatting  │    │ Tracking        │  │
│  └─────────────┘    └──────────────┘    └─────────────┘    └─────────────────┘  │
└─────────────────────────────────────────────────────┬───────────────────────────┘
                                                      │
┌─────────────────────────────────────────────────────▼───────────────────────────┐
│                           VECTOR STORE                                         │
│                          (backend/vector_store.py)                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌──────────────┐    ┌─────────────┐    ┌─────────────────┐  │
│  │ Course      │───▶│ Filter       │───▶│ ChromaDB    │───▶│ Search Results  │  │
│  │ Resolution  │    │ Building     │    │ Query       │    │ Package         │  │
│  └─────────────┘    └──────────────┘    └─────────────┘    └─────────────────┘  │
└─────────────────────────────────────────────────────┬───────────────────────────┘
                                                      │
                              ┌───────────────────────▼───────────────────────┐
                              │               CHROMADB                        │
                              │            (Vector Database)                  │
                              │                                               │
                              │  ┌─────────────────┐  ┌─────────────────────┐ │
                              │  │ Course Catalog  │  │   Course Content    │ │
                              │  │   Collection    │  │    Collection       │ │
                              │  │                 │  │                     │ │
                              │  │ • Course Titles │  │ • Text Chunks       │ │
                              │  │ • Instructors   │  │ • Embeddings        │ │
                              │  │ • Metadata      │  │ • Course/Lesson IDs │ │
                              │  └─────────────────┘  └─────────────────────┘ │
                              └───────────────────────────────────────────────┘
```

## Data Flow Sequence

```
┌──────┐     ┌─────────┐     ┌──────────┐     ┌─────────────┐     ┌─────────────┐
│User  │────▶│Frontend │────▶│FastAPI   │────▶│RAG System   │────▶│AI Generator │
│Query │     │Script   │     │Endpoint  │     │Orchestrator │     │(Claude)     │
└──────┘     └─────────┘     └──────────┘     └─────────────┘     └─────────────┘
                                                                         │
                                                                         ▼
┌──────────┐     ┌──────────┐     ┌─────────────┐     ┌──────────────────┴──┐
│Response  │◀────│Source    │◀────│Search Tool  │◀────│Tool Decision/       │
│to User   │     │Tracking  │     │Execution    │     │Execution            │
└──────────┘     └──────────┘     └─────────────┘     └─────────────────────┘
                                          │
                                          ▼
                                  ┌─────────────┐     ┌─────────────┐
                                  │Vector Store │────▶│ChromaDB     │
                                  │Search       │     │Query        │
                                  └─────────────┘     └─────────────┘
```

## Component Interactions

```
                    ┌─────────────────────────────────────┐
                    │           SESSION MANAGER          │
                    │        Conversation History        │
                    └─────────────┬───────────────────────┘
                                  │ Provides Context
                                  ▼
    ┌─────────────┐         ┌─────────────┐         ┌─────────────┐
    │   CLAUDE    │◀───────▶│    TOOL     │────────▶│   VECTOR    │
    │     AI      │   Uses  │   MANAGER   │ Queries │    STORE    │
    │             │         │             │         │             │
    └─────────────┘         └─────────────┘         └─────────────┘
           │                                               │
           │ Synthesizes                                   │ Retrieves
           ▼                                               ▼
    ┌─────────────┐                                ┌─────────────┐
    │  NATURAL    │                                │   COURSE    │
    │  LANGUAGE   │                                │   CHUNKS    │
    │  RESPONSE   │                                │   & META    │
    └─────────────┘                                └─────────────┘
```

## Error Handling Flow

```
┌─────────────┐     Error     ┌─────────────┐     Error     ┌─────────────┐
│  Frontend   │──────────────▶│   Backend   │──────────────▶│    User     │
│  Validation │               │  Exception  │               │   Friendly  │
│             │               │  Handling   │               │   Message   │
└─────────────┘               └─────────────┘               └─────────────┘
       │                             │                             │
       │ Network Error               │ Search Error                │ UI Update
       ▼                             ▼                             ▼
┌─────────────┐               ┌─────────────┐               ┌─────────────┐
│   Loading   │               │   Graceful  │               │   Error     │
│  Animation  │               │  Fallback   │               │  Display    │
│   Removal   │               │  Response   │               │             │
└─────────────┘               └─────────────┘               └─────────────┘
```